<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ú—É–∑—ã–∫–∞ —Ç–≤–æ–µ–≥–æ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #141e30, #243b55);
      color: #fff;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      background: rgba(0,0,0,0.4);
      padding: 24px;
      border-radius: 16px;
      max-width: 480px;
      width: 100%;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    h1 { margin-top: 0; }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 12px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }
    button {
      background: #ff5c8a;
      color: #fff;
      cursor: pointer;
    }
    button:hover { opacity: 0.9; }
    .section {
      margin-top: 20px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,0.2);
    }
    a { color: #ffd1e1; text-decoration: none; }
  </style>
</head>
<body>
  <div class="card">
    <h1>üéÇ –ú—É–∑—ã–∫–∞ —Ç–≤–æ–µ–≥–æ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è</h1>
    <p>–í—ã–±–µ—Ä–∏ –¥–∞—Ç—É ‚Äî —è –ø–æ–∫–∞–∂—É —Ä–µ–ª–∏–∑ –¥–Ω—è –∏ –≥–ª–∞–≤–Ω—ã–π —Ö–∏—Ç –Ω–µ–¥–µ–ª–∏</p>

    <input type="date" id="birthdate" />
    <button onclick="loadMusic()">–ü–æ–∫–∞–∑–∞—Ç—å</button>

    <div class="section">
      <button onclick="showTab('day')">üéÇ –†–µ–ª–∏–∑—ã –¥–Ω—è</button>
      <button onclick="showTab('week')">üî• –¢—Ä–µ–∫ –Ω–µ–¥–µ–ª–∏</button>
    </div>
    <div id="result"></div>
  </div>

  <script>
    let currentTab = 'day';
    function showTab(tab) {
      currentTab = tab;
      loadMusic();
    }
    // –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –≤–º–µ—Å—Ç–æ JS ‚Äî —Å–∞–º—ã–π –Ω–∞–¥—ë–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
// (JS-—Ä–µ–¥–∏—Ä–µ–∫—Ç—ã –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å—Ä–µ–¥–æ–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞)


    async function loadMusic() {
      const date = document.getElementById('birthdate').value;
      const result = document.getElementById('result');
      result.innerHTML = '';

      if (!date) {
        result.innerHTML = '‚ùó –í—ã–±–µ—Ä–∏ –¥–∞—Ç—É';
        return;
      }

      const [year, month, day] = date.split('-');

      // 1. –†–µ–ª–∏–∑—ã –¥–Ω—è (MusicBrainz)
      if (currentTab === 'day') {
        try {
          const mbRes = await fetch(mbUrl, { headers: { 'User-Agent': 'BirthdayMusicApp/1.0' } });
          const mbData = await mbRes.json();

          if (mbData.releases && mbData.releases.length > 0) {
            result.innerHTML += '<div class="section"><h3>üéÇ –†–µ–ª–∏–∑—ã –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å</h3></div>';

            // —Å–Ω–∞—á–∞–ª–∞ –æ—Ç—Ñ–∏–ª—å—Ç—Ä—É–µ–º –Ω–µ-–∞–ª—å–±–æ–º—ã
            const filtered = mbData.releases.filter(r => r['release-group']?.['primary-type'] !== 'Album');
            const items = [];

            for (const rel of filtered) {
              const title = rel.title;
              const artist = rel['artist-credit']?.[0]?.name || 'Unknown';

              const itunesUrl = `https://itunes.apple.com/search?term=${encodeURIComponent(artist + ' ' + title)}&media=music&entity=song&limit=1`;
              let hasPreview = false;
              let previewHtml = '<div>üîá –ü—Ä–µ–≤—å—é –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</div>';

              try {
                const itRes = await fetch(itunesUrl);
                const itData = await itRes.json();
                if (itData.results?.[0]?.previewUrl) {
                  hasPreview = true;
                  previewHtml = `<audio controls src="${itData.results[0].previewUrl}"></audio>`;
                }
              } catch {}

              const ytLink = `https://www.youtube.com/results?search_query=${encodeURIComponent(artist + ' ' + title + ' official music video')}`;

              items.push({ title, artist, previewHtml, ytLink, hasPreview });
            }

            // —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–Ω–∞—á–∞–ª–∞ —Å –ø—Ä–µ–≤—å—é
            items.sort((a, b) => Number(b.hasPreview) - Number(a.hasPreview));

            for (const item of items) {
              result.innerHTML += `<div class="section">
                <strong>${item.title}</strong><br>
                ${item.artist}<br>
                ${item.previewHtml}<br>
                <a href="${item.ytLink}" target="_blank" rel="noopener noreferrer">‚ñ∂Ô∏è YouTube</a>
              </div>`;
            }
          } else {
            result.innerHTML += '<div class="section">–ù–µ—Ç —Ä–µ–ª–∏–∑–æ–≤ –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å</div>';
          }
        } catch {
          result.innerHTML += '<div class="section">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ MusicBrainz</div>';
        }
      }

      // 2. –°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Ç—Ä–µ–∫ (–∑–∞–≥–ª—É—à–∫–∞ Billboard)
      const billboardExample = { title: 'Macarena', artist: 'Los del R√≠o' };
      const bbQuery = `${billboardExample.artist} ${billboardExample.title} official music video`;
      const bbYt = `https://www.youtube.com/results?search_query=${encodeURIComponent(bbQuery)}`;

      result.innerHTML += `<div class="section">
        <h3>üî• –°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Ç—Ä–µ–∫ –Ω–µ–¥–µ–ª–∏</h3>
        <strong>${billboardExample.title}</strong><br>
        ${billboardExample.artist}<br>
        <a href="${bbYt}" target="_blank" rel="noopener noreferrer" referrerpolicy="no-referrer">‚ñ∂Ô∏è –°–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ YouTube</a>
      </div>`;
    }
  </script>
</body>
</html>
